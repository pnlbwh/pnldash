---
title: "Flexdashboard"
output:
  flexdashboard::flex_dashboard:
      theme: cosmo
      navbar:
      - { title: "PNL Project Dashboard Test", align: right }
      source_code: embed
      vertical_layout: scroll
---

Overview
=====================================

```{r}
require("data.table")
paths <- fread("paths.csv")
diffPaths <- fread("diffPaths.csv")
paths.byProject = paths[paths[,exists],.('project files (MB)'=sum(sizeMB)),by=projectPath]
diffPaths.byProject = diffPaths[,.('extra files (MB)'=sum(sizeMB)), by=projectPath]
table = merge(paths.byProject, diffPaths.byProject, by="projectPath")
DT::datatable(table, options = list(bPaginate=F))
```

```{r include=FALSE}
require(knitr)
require(data.table)
paths <- fread('paths.csv')
params <- fread('params.csv')
paths.grouped <- paths[,.(completed=sum(exists), total=.N), by=.(projectPath, pathKey, paramId)]

summarizePipeline <- function(projectPath, projectSD) {
  result = projectSD[,
          {
          pp=projectPath
          pi=paramId
          paramCombo = params[projectPath==pp & paramId==pi, .(parameter=param, "parameter value"=paramValue),]
          setorder(paramCombo, parameter)
          paramTable = kable(paramCombo)
          pathsSummary = kable(.SD)
          knit_expand(text='#### Pipeline id: {{paramId}} \
          {{paramTable}} \
          {{pathsSummary}} \
          ')
          }, by=.(paramId)][,V1]

  c(knit_expand(text='# {{projectPath}} {data-navmenu="Projects"}'), result)
}

out = paths.grouped[,
  {
  summarizePipeline(projectPath, .SD)
  }
  , by=.(projectPath)][,V1]

```

`r paste(knit(text = out), collapse = '\n')`


All Project Files
=====================================


```{r}
require("DT")
d <- fread("paths.csv")
setorder(d, -exists, -sizeMB)
DT::datatable(d, options = list(bPaginate=F))
```

All Extra Files
=====================================

```{r}
d <- fread("diffPaths.csv")
setorder(d, -sizeMB)
DT::datatable(d, options = list(bPaginate=F))
```
